# This file autogenerated by Chef
# Do not edit, changes will be overwritten
<% if not node["custom_template_banner"].nil? %>
<%= node["custom_template_banner"] %>
<% end %>
[DEFAULT]

# LOGS/STATE
verbose=true
debug=<%= @debug %>
<% if node["nova"]["ratelimit"]["api"]["enabled"] %>
auth_strategy=keystone
<% else %>
auth_strategy=keystone_nolimit
<% end %>

logdir=/var/log/nova
#log_config=/etc/nova/logging.conf
state_path=/var/lib/nova
lock_path=/var/lock/nova

##### RABBITMQ #####
<%= render "partials/queue-options.partial.erb" %>

##### SCHEDULER #####
<%= render "partials/scheduler-options.partial.erb" %>

##### NETWORK #####
<%= render "partials/network-options.partial.erb" %>

##### GLANCE #####
image_service=nova.image.glance.GlanceImageService
glance_api_servers=<%= @glance_serverlist %>

##### COMPUTE #####
<%= render "partials/compute-options.partial.erb" %>

##### VNCPROXY #####
<%= render "partials/vncproxy-options.partial.erb" %>

##### MISC #####
# force backing images to raw format
force_raw_images=<%= @force_raw_images %>
allow_same_net_traffic=<%= @allow_same_net_traffic %>
osapi_max_limit=<%= @osapi_max_limit %>
snapshot_image_format=<%= @snapshot_image_format %>
start_guests_on_host_boot=<%= @start_guests_on_host_boot %>
resume_guests_state_on_host_boot=<%= @resume_guests_state_on_host_boot %>
# number of security groups per project (default: 10)
quota_security_groups=<%= @quota_security_groups %>
# number of security rules per security group (default: 20)
quota_security_group_rules=<%= @quota_security_group_rules %>
quota_fixed_ips=<%= @quota_fixed_ips %>
quota_instances=<%= @quota_instances %>
max_age=<%= @max_age %>
rpc_backend=nova.openstack.common.rpc.impl_kombu
<% if @force_config_drive -%>
force_config_drive=<%= @force_config_drive %>
config_drive_format=<%= @config_drive_format %>
<% end -%>
<% unless @memcached_servers.nil? -%>
memcached_servers=<%= @memcached_servers %>
<% end -%>

reserved_host_disk_mb = <%= @reserved_host_disk_mb %>
# TODO(shep): not sure if this should go in partial scheduler-options
#             leaving here for now
<%- if /FilterScheduler/.match(@scheduler_driver) or
       /MultiScheduler/.match(@scheduler_driver) %>
# FilterScheduler Only Options
<%- if /ComputeFilter/.match(@scheduler_default_filters) %>
# virtual CPU to Physical CPU allocation ratio (default: 16.0)
cpu_allocation_ratio=<%= @cpu_allocation_ratio %>
<%- end %>
<%- if /RamFilter/.match(@scheduler_default_filters) %>
# virtual ram to physical ram allocation ratio (default: 1.5)
ram_allocation_ratio=<%= @ram_allocation_ratio %>
<%- end %>
<%- if /DiskFilter/.match(@scheduler_default_filters) -%>
disk_allocation_ratio=<%= @disk_allocation_ratio %>
<%- end -%>
<%- elsif /SimpleScheduler/.match(@scheduler_driver) %>
# SimpleScheduler Only Options
# maximum number of instance cores to allow per host
max_cores=<% @cpu_allocation_ratio.to_i * node["cpu"]["total"].to_i %>
<%- end %>
image_cache_manager_interval=<%= @image_cache_manager_interval %>

##### KEYSTONE #####
keystone_ec2_url=<%= @keystone_service_protocol %>://<%= @keystone_api_ipaddress %>:<%= @keystone_service_port %>/v2.0/ec2tokens

##### VOLUMES #####
# iscsi target user-land tool to use
# NOTE(darren): (this is a nova-volume attribute - cinder carries this
# separately in it's own cinder.conf
iscsi_helper=<%= @iscsi_helper %>

# when in folsom...
volume_manager=cinder.volume.manager.VolumeManager
volume_api_class=nova.volume.cinder.API
enabled_apis=ec2,osapi_compute,metadata
cinder_catalog_info=<%= @cinder_catalog_info %>

##### API #####
ec2_workers=<%= node["nova"]["config"]["ec2_workers"] %>
osapi_compute_workers=<%= node["nova"]["config"]["osapi_compute_workers"] %>
metadata_listen=<%= @metadata_listen %>
metadata_listen_port=<%= @metadata_listen_port %>
metadata_workers=<%= node["nova"]["config"]["metadata_workers"] %>
osapi_volume_workers=<%= node["nova"]["config"]["osapi_volume_workers"] %>
osapi_compute_listen=<%= @osapi_compute_listen %>
osapi_compute_listen_port=<%= @osapi_compute_listen_port %>
ec2_listen=<%= @ec2_listen %>
ec2_listen_port=<%= @ec2_listen_port %>
ec2_host=<%= @ec2_host %>
<% if %w(fedora redhat centos).include? node.platform -%>
# Adding support for non-modded euca2ools to display ip address info
# https://bugs.launchpad.net/nova/+bug/901594
ec2_private_dns_show_ip=True
<% end -%>

<% if @iscsi_use_multipath == true -%>
##### EMC Multi-Path ####
libvirt_iscsi_use_multipath = "True"
<% end -%>

##### CEILOMETER #####
<% if @use_ceilometer.to_s.capitalize() == "True" -%>
instance_usage_audit=<%= @use_ceilometer.to_s.capitalize() %>
instance_usage_audit_period=hour
notification_driver=nova.openstack.common.notifier.rpc_notifier
notification_driver=ceilometer.compute.nova_notifier
<% else -%>
# disabled because ceilometer::ceilometer-compute is not in the run_list
<% end -%>

##### DATABASE CONNECTIONS #####
[DATABASE]
connection_debug=<%= @sql_connection_debug %>
idle_timeout=<%= @sql_idle_timeout %>
retry_interval=<%= @sql_retry_interval %>
max_retries=<%= @sql_max_retries %>
min_pool_size=<%= @sql_min_pool_size %>
<% if @sql_max_pool_size -%>
max_pool_size=<%= @sql_max_pool_size %>
<% end -%>
<% if @sql_max_overflow -%>
max_overflow=<%= @sql_max_overflow %>
<% end -%>
